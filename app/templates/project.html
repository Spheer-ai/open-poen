{% extends "base.html" %}
{% block head %}
  <title>Open Poen - {{ project.name }}</title>
  <meta property="og:title" content="Open Poen - {{ project.name }}" />
  {{ super() }}
{% endblock %}

{% block content %}
  <div class="text-center">
    <a href="/">Home</a> > {{ project.name }}
  </div>

  <div class="row">
    <div class="col-12 col-md-4">
      ter beschikking door:
      {% for funder in project.funders %}
        <a href="{{ funder.url }}" target="_blank" rel="noopener">{{ funder.name }}</a>
      {% endfor %}
    </div>

    <div class="col-12 col-md-4 text-center">
      <p><b>{{ project.name }}</b></p>
      <p>resterend: {{ amounts['left_str'] }}</p>
      <p>uitgegeven: {{ amounts['spent_str'] }}</p>
      <p>totaal: {{ amounts['awarded_str'] }}</p>
      <p>percentage: {{ amounts['percentage_spent_str'] }}</p>
    </div>

    <div class="col-12 col-md-4">
      <!-- Button trigger modal -->
      <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#subproject-toevoegen">
        Subproject toevoegen
      </button>

      <!-- Modal -->
      <div class="modal fade" id="subproject-toevoegen" tabindex="-1" role="dialog" aria-labelledby="subprojectToevoegenLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <form method="POST" action="">
              <div class="modal-header">
                <h5 class="modal-title" id="subprojectToevoegenLabel">Subproject Toevoegen</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">
                <div>
                  {{ subproject_form.csrf_token }}

                  {% for f in subproject_form %}
                    {% if f.widget.input_type != 'hidden' and f.widget.input_type != 'submit' %}
                      <div>
                        {{ f.label }}
                        <br>
                        {{ f }}
                        {% for error in f.errors %}
                          <span style="color: red;">- {{ error }}</span>
                        {% endfor %}
                      </div>
                    {% endif %}
                  {% endfor %}
                  {{ subproject_form.project_id }}
                </div>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                {{ subproject_form.submit }}
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>

  <table class="table">
    <tr>
      <th>waarvoor?</th>
      <th>bedrag â‚¬</th>
      <th>ontvanger</th>
      <th>initiatiefnemer</th>
      <th>omschrijving</th>
      <th>datum</th>
      <th>media</th>
      <th>info</th>
      <th>details</th>
    </tr>
    {% for subproject in project.subprojects %}
      {% for payment in subproject.payments|sort(attribute='created', reverse=true) %}
        <tr>
          <td><a href="{{ url_for('subproject', project_id=project.id, subproject_id=subproject.id) }}">{{ subproject.name }}</a></td>
          <td>{{ payment.amount_value }}</td>
          <td>{{ payment.counterparty_alias_name }}</td>
          <td>{{ payment.alias_name }}</td>
          {% if payment.short_user_description %}
            <td>{{ payment.short_user_description }}</td>
          {% else %}
            <td><i>nog niet toegevoegd</i></td>
          {% endif %}
          <td>{{ payment.created.strftime('%Y-%m-%d') }}</td>
          <td>TODO</td>
          <td>TODO</td>
          <td>TODO</td>
        </tr>
      {% endfor %}
    {% endfor %}
  </table>
{% endblock %}
